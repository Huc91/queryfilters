function Combinators(){const t="filtering";this.getCombinators=function(){return["and",t,"filtering_or","or"]},this.getDefaultCombinator=function(){return t}}function QueryStringBuilder(){this.filters=[];var t=new Combinators;this.combinators=t.getCombinators(),this.combine=t.getDefaultCombinator(),this.ensureHaveValidCombinator=function(){if(!this.combinators.includes(this.getCombinator()))throw new Error("combinator "+this.getCombinator()+" is not available");return this},this.setCombinator=function(t){return this.combine=t,this},this.getCombinator=function(){return this.combine},this.setFilters=function(t){return this.filters=t,this},this.build=function(){var t="",i="";for(f in this.filters){var e=this.filters[f];this.containsRelations(e)&&(splitted=e.field.split("."),splitted.pop(),this.containsEmbedded(e)&&splitted.shift(),i+=""!=i?","+splitted.join():"rel="+splitted.join()),""!=t&&(t+="&"),t+=this.combine+"["+this.getFilterIndex(e)+"]="+e.value}return j="",""!=i&&""!=t&&(j="&"),i+j+t},this.getFilterIndex=function(t){return!this.containsEmbedded(t)&&this.containsRelations(t)?"_embedded."+t.field:t.field},this.containsRelations=function(t){return-1!==t.field.indexOf(".")},this.containsEmbedded=function(t){return 0===t.field.indexOf("_embedded")}}function FilterManager(){this.filters=[],this.push=function(t){this.filters.push(t)},this.getFilters=function(){return this.filters},this.getFilter=function(t){return this.filters[t]},this.getFields=function(){var t=[];for(f in this.getFilters())t.push(this.getFilter(f).field);return t}}function QueryQl(){this.setCombinator=function(t){return this.builder.setCombinator(t),this},this.builder=new QueryStringBuilder,this.filterManager=new FilterManager,this.rel=[],this.applyFilter=function(t){this.filterManager.push(t)},this.getRels=function(){this.rel=[];for(f in this.filterManager.getFilters()){var t=this.filterManager.getFilter(f);this.builder.containsRelations(t)&&(filterRelation=t.field.split(".")[1],this.rel.push(filterRelation))}return this.rel},this.getQueryString=function(){return this.builder.ensureHaveValidCombinator().setFilters(this.filterManager.getFilters()).build()},this.getFilters=function(){return this.filterManager.getFields()},this.containsCombinator=function(t){for(i in t)if("object"==typeof t[i])return!0;return!1},this.detectCombinator=function(t){for(i in t)if("object"==typeof t[i])return i;return!1},this.keepDefaultCombinator=function(){return this},this.keepOrFilteringCombinator=function(){return this.setCombinator("filtering_or"),this},this.json=function(t){var e=t;if(this.containsCombinator(t)){var n=this.detectCombinator(t);this.setCombinator(n),e=t[n]}for(i in e)this.applyFilter({field:i,value:e[i]})}}global.module=global.module||{},(module||{}).exports=QueryQl;